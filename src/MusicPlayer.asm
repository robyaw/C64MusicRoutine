Note_C_0$           = $0115                             ; 16.4 Hz
Note_Cs0$           = $0125                             ; 17.3 Hz
Note_D_0$           = $0137                             ; 18.4 Hz
Note_Ds0$           = $0149                             ; 19.4 Hz
Note_E_0$           = $015D                             ; 20.6 Hz
Note_F_0$           = $0172                             ; 21.8 Hz
Note_Fs0$           = $0188                             ; 23.1 Hz
Note_G_0$           = $019F                             ; 24.5 Hz
Note_Gs0$           = $01B8                             ; 26.0 Hz
Note_A_0$           = $01D2                             ; 27.5 Hz
Note_As0$           = $01EE                             ; 29.1 Hz
Note_B_0$           = $020B                             ; 30.9 Hz
Note_C_1$           = $022A                             ; 32.7 Hz
Note_Cs1$           = $024B                             ; 34.6 Hz
Note_D_1$           = $026E                             ; 36.7 Hz
Note_Ds1$           = $0293                             ; 38.9 Hz
Note_E_1$           = $02BA                             ; 41.2 Hz
Note_F_1$           = $02E3                             ; 43.7 Hz
Note_Fs1$           = $030F                             ; 46.3 Hz
Note_G_1$           = $033E                             ; 49.0 Hz
Note_Gs1$           = $036F                             ; 51.9 Hz
Note_A_1$           = $03A4                             ; 55.0 Hz
Note_As1$           = $03DB                             ; 58.3 Hz
Note_B_1$           = $0416                             ; 61.7 Hz
Note_C_2$           = $0454                             ; 65.4 Hz
Note_Cs2$           = $0496                             ; 69.3 Hz
Note_D_2$           = $04DC                             ; 73.4 Hz
Note_Ds2$           = $0526                             ; 77.8 Hz
Note_E_2$           = $0574                             ; 82.4 Hz
Note_F_2$           = $05C7                             ; 87.3 Hz
Note_Fs2$           = $061F                             ; 92.5 Hz
Note_G_2$           = $067C                             ; 98.0 Hz
Note_Gs2$           = $06DF                             ; 103.8 Hz
Note_A_2$           = $0747                             ; 110.0 Hz
Note_As2$           = $07B6                             ; 116.5 Hz
Note_B_2$           = $082C                             ; 123.5 Hz
Note_C_3$           = $08A8                             ; 130.8 Hz
Note_Cs3$           = $092C                             ; 138.6 Hz
Note_D_3$           = $09B7                             ; 146.8 Hz
Note_Ds3$           = $0A4B                             ; 155.6 Hz
Note_E_3$           = $0AE8                             ; 164.8 Hz
Note_F_3$           = $0B8E                             ; 174.6 Hz
Note_Fs3$           = $0C3E                             ; 185.0 Hz
Note_G_3$           = $0CF8                             ; 196.0 Hz
Note_Gs3$           = $0DBE                             ; 207.7 Hz
Note_A_3$           = $0E8F                             ; 220.0 Hz
Note_As3$           = $0F6C                             ; 233.1 Hz
Note_B_3$           = $1057                             ; 246.9 Hz
Note_C_4$           = $1150                             ; 261.6 Hz
Note_Cs4$           = $1258                             ; 277.2 Hz
Note_D_4$           = $136F                             ; 293.7 Hz
Note_Ds4$           = $1496                             ; 311.1 Hz
Note_E_4$           = $15D0                             ; 329.6 Hz
Note_F_4$           = $171C                             ; 349.2 Hz
Note_Fs4$           = $187C                             ; 370.0 Hz
Note_G_4$           = $19F0                             ; 392.0 Hz
Note_Gs4$           = $1B7B                             ; 415.3 Hz
Note_A_4$           = $1D1E                             ; 440.0 Hz
Note_As4$           = $1ED9                             ; 466.2 Hz
Note_B_4$           = $20AE                             ; 493.9 Hz
Note_C_5$           = $22A0                             ; 523.3 Hz
Note_Cs5$           = $24AF                             ; 554.4 Hz
Note_D_5$           = $26DD                             ; 587.3 Hz
Note_Ds5$           = $292D                             ; 622.3 Hz
Note_E_5$           = $2BA0                             ; 659.3 Hz
Note_F_5$           = $2E38                             ; 698.5 Hz
Note_Fs5$           = $30F8                             ; 740.0 Hz
Note_G_5$           = $33E1                             ; 784.0 Hz
Note_Gs5$           = $36F6                             ; 830.6 Hz
Note_A_5$           = $3A3B                             ; 880.0 Hz
Note_As5$           = $3DB2                             ; 932.3 Hz
Note_B_5$           = $415C                             ; 987.8 Hz
Note_C_6$           = $4540                             ; 1046.5 Hz
Note_Cs6$           = $495E                             ; 1108.8 Hz
Note_D_6$           = $4DBB                             ; 1174.7 Hz
Note_Ds6$           = $525A                             ; 1244.5 Hz
Note_E_6$           = $573F                             ; 1318.5 Hz
Note_F_6$           = $5C6F                             ; 1396.9 Hz
Note_Fs6$           = $61EF                             ; 1480.0 Hz
Note_G_6$           = $67C2                             ; 1568.0 Hz
Note_Gs6$           = $6DED                             ; 1661.2 Hz
Note_A_6$           = $7476                             ; 1760.0 Hz
Note_As6$           = $7B63                             ; 1864.7 Hz
Note_B_6$           = $82B9                             ; 1975.5 Hz
Note_C_7$           = $8A7F                             ; 2093.0 Hz
Note_Cs7$           = $92BC                             ; 2217.5 Hz
Note_D_7$           = $9B75                             ; 2349.3 Hz
Note_Ds7$           = $A4B4                             ; 2489.0 Hz
Note_E_7$           = $AE7F                             ; 2637.0 Hz
Note_F_7$           = $B8DF                             ; 2793.8 Hz
Note_Fs7$           = $C3DE                             ; 2960.0 Hz
Note_G_7$           = $CF84                             ; 3136.0 Hz
Note_Gs7$           = $DBD9                             ; 3322.4 Hz
Note_A_7$           = $E8ED                             ; 3520.0 Hz
Note_As7$           = $F6C6                             ; 3729.3 Hz

V1_Freq_Lo          = $D400
V1_Freq_Hi          = $D401
V1_Pulse_Lo         = $D402
V1_Pulse_Hi         = $D403
V1_Control          = $D404
V1_Attack_Decay     = $D405
V1_Sustain_Release  = $D406

V2_Freq_Lo          = $D407
V2_Freq_Hi          = $D408
V2_Pulse_Lo         = $D409
V2_Pulse_Hi         = $D40A
V2_Control          = $D40B
V2_Attack_Decay     = $D40C
V2_Sustain_Release  = $D40D

SID_Volume          = $D418
ColorRAM            = $D800

; 10 SYS 2064
*=$0801
                    byte    $0E, $08, $0A, $00, $9E, $20, $32, $30, $36, $34, $00, $00, $00

;-------------------------------------------------------
; Music Data
;-------------------------------------------------------

; Ghost Registers
*=$3000
Pulse_Lo_Ghost      byte    000, 000
Pulse_Hi_Ghost      byte    000, 000
Control_Ghost       byte    000, 000

*=$2000

; Notes jump table
Note_Lo             byte    <Note_C_0$, <Note_Cs0$, <Note_D_0$, <Note_Ds0$, <Note_E_0$, <Note_F_0$, <Note_Fs0$, <Note_G_0$, <Note_Gs0$, <Note_A_0$, <Note_As0$, <Note_B_0$, <Note_C_1$, <Note_Cs1$, <Note_D_1$, <Note_Ds1$, <Note_E_1$, <Note_F_1$, <Note_Fs1$, <Note_G_1$, <Note_Gs1$, <Note_A_1$, <Note_As1$, <Note_B_1$, <Note_C_2$, <Note_Cs2$, <Note_D_2$, <Note_Ds2$, <Note_E_2$, <Note_F_2$, <Note_Fs2$, <Note_G_2$, <Note_Gs2$, <Note_A_2$, <Note_As2$, <Note_B_2$, <Note_C_3$, <Note_Cs3$, <Note_D_3$, <Note_Ds3$, <Note_E_3$, <Note_F_3$, <Note_Fs3$, <Note_G_3$, <Note_Gs3$, <Note_A_3$, <Note_As3$, <Note_B_3$, <Note_C_4$, <Note_Cs4$, <Note_D_4$, <Note_Ds4$, <Note_E_4$, <Note_F_4$, <Note_Fs4$, <Note_G_4$, <Note_Gs4$, <Note_A_4$, <Note_As4$, <Note_B_4$, <Note_C_5$, <Note_Cs5$, <Note_D_5$, <Note_Ds5$, <Note_E_5$, <Note_F_5$, <Note_Fs5$, <Note_G_5$, <Note_Gs5$, <Note_A_5$, <Note_As5$, <Note_B_5$, <Note_C_6$, <Note_Cs6$, <Note_D_6$, <Note_Ds6$, <Note_E_6$, <Note_F_6$, <Note_Fs6$, <Note_G_6$, <Note_Gs6$, <Note_A_6$, <Note_As6$, <Note_B_6$, <Note_C_7$, <Note_Cs7$, <Note_D_7$, <Note_Ds7$, <Note_E_7$, <Note_F_7$, <Note_Fs7$, <Note_G_7$, <Note_Gs7$, <Note_A_7$, <Note_As7$
Note_Hi             byte    >Note_C_0$, >Note_Cs0$, >Note_D_0$, >Note_Ds0$, >Note_E_0$, >Note_F_0$, >Note_Fs0$, >Note_G_0$, >Note_Gs0$, >Note_A_0$, >Note_As0$, >Note_B_0$, >Note_C_1$, >Note_Cs1$, >Note_D_1$, >Note_Ds1$, >Note_E_1$, >Note_F_1$, >Note_Fs1$, >Note_G_1$, >Note_Gs1$, >Note_A_1$, >Note_As1$, >Note_B_1$, >Note_C_2$, >Note_Cs2$, >Note_D_2$, >Note_Ds2$, >Note_E_2$, >Note_F_2$, >Note_Fs2$, >Note_G_2$, >Note_Gs2$, >Note_A_2$, >Note_As2$, >Note_B_2$, >Note_C_3$, >Note_Cs3$, >Note_D_3$, >Note_Ds3$, >Note_E_3$, >Note_F_3$, >Note_Fs3$, >Note_G_3$, >Note_Gs3$, >Note_A_3$, >Note_As3$, >Note_B_3$, >Note_C_4$, >Note_Cs4$, >Note_D_4$, >Note_Ds4$, >Note_E_4$, >Note_F_4$, >Note_Fs4$, >Note_G_4$, >Note_Gs4$, >Note_A_4$, >Note_As4$, >Note_B_4$, >Note_C_5$, >Note_Cs5$, >Note_D_5$, >Note_Ds5$, >Note_E_5$, >Note_F_5$, >Note_Fs5$, >Note_G_5$, >Note_Gs5$, >Note_A_5$, >Note_As5$, >Note_B_5$, >Note_C_6$, >Note_Cs6$, >Note_D_6$, >Note_Ds6$, >Note_E_6$, >Note_F_6$, >Note_Fs6$, >Note_G_6$, >Note_Gs6$, >Note_A_6$, >Note_As6$, >Note_B_6$, >Note_C_7$, >Note_Cs7$, >Note_D_7$, >Note_Ds7$, >Note_E_7$, >Note_F_7$, >Note_Fs7$, >Note_G_7$, >Note_Gs7$, >Note_A_7$, >Note_As7$
; Song Data
Song1_S1_Notes      byte    043, 050, 048, 046, 045, 043, 048, 048, 050, $ff
Song1_S1_Length     byte    030, 035, 020, 020, 030, 040, 020, 010, 020, $ff
Song1_S2_Notes      byte    031,           $fe, $fe,                     $ff
Song1_S2_Length     byte    090,           020, 100,                     $ff
; Control Variables
Note_Num            byte    000, 000
Note_Cnt            byte    000, 000


;-------------------------------------------------------
; Program Start
;-------------------------------------------------------
*=$0810

                    SEI                                 ; disable maskable interrupts

; set screen
                    LDY     #$00                        
                    STY     $D021                       
                    STY     $D020                       
                    LDA     #$07                        
                    LDX     #040                        

Loop_SetBG          TAY
                    INY
                    INY
                    INY
                    TYA
                    AND     #%00001111                  
                    BNE     SetBG                       
                    INY
SetBG               LDA     #$01
                    STA     ColorRAM,X
                    TYA
                    STA     ColorRAM+040,X              
                    STA     ColorRAM+080,X              
                    STA     ColorRAM+120,X              
                    STA     ColorRAM+160,X              
                    STA     ColorRAM+200,X              
                    STA     ColorRAM+240,X              
                    STA     ColorRAM+280,X              
                    STA     ColorRAM+320,X              
                    STA     ColorRAM+360,X              
                    STA     ColorRAM+400,X              
                    STA     ColorRAM+440,X              
                    STA     ColorRAM+480,X              
                    STA     ColorRAM+520,X              
                    STA     ColorRAM+560,X              
                    STA     ColorRAM+600,X              
                    STA     ColorRAM+640,X              
                    STA     ColorRAM+680,X              
                    STA     ColorRAM+720,X              
                    STA     ColorRAM+760,X              
                    STA     ColorRAM+800,X              
                    STA     ColorRAM+840,X              
                    STA     ColorRAM+880,X              
                    STA     ColorRAM+920,X              
                    STA     ColorRAM+960,X              
                    DEX
                    BPL     Loop_SetBG                        

;-------------------------------------------------------
                    LDY     #%00000101                  ; SET VOLUME
                    STY     SID_Volume                  
                    LDY     #%00100001                  
                    STY     V1_Attack_Decay             
                    STY     V2_Attack_Decay             
                    LDY     #%01001010                  
                    STY     V1_Sustain_Release          
                    STY     V2_Sustain_Release          
                    LDY     #012                        
                    LDX     #000                        
                    STY     V1_Pulse_Lo                 
                    STY     Pulse_Lo_Ghost+000          
                    INX
                    STY     V2_Pulse_Lo                 
                    STY     Pulse_Lo_Ghost+001          
                    DEX
                    LDY     #008                        
                    STY     V1_Pulse_Hi                 
                    STY     Pulse_Hi_Ghost+000          
                    INX
                    STY     V2_Pulse_Hi                 
                    STY     Pulse_Hi_Ghost+001          

Set_Voice           LDA     #000                        ; Set note count to 0 (unrolled)
                    STA     Note_Num
                    STA     Note_Num+1  

                    LDA     Song1_S2_Length             ; Set note lengths (unrolled)
                    STA     Note_Cnt+1      
                    LDA     Song1_S1_Length          
                    STA     Note_Cnt                  
                    
                    LDX     Song1_S2_Notes              ; Set notes (unrolled)
                    LDA     Note_Lo,X                   
                    STA     V2_Freq_Lo                  
                    LDA     Note_Hi,X                   
                    STA     V2_Freq_Hi                  
                    
                    LDX     Song1_S1_Notes          
                    LDA     Note_Lo,X                   
                    STA     V1_Freq_Lo                  
                    LDA     Note_Hi,X                   
                    STA     V1_Freq_Hi                                               

Set_Control         LDY     #%00010001                  
                    STY     Control_Ghost               
                    STY     V1_Control                  

                    LDY     #%01000001                  
                    STY     Control_Ghost               
                    STY     V2_Control                  

Init                LDA     #%01111111
                    STA     $DC0D                       ;"SWITCH OFF" INTERRUPTS SIGNALS FROM CIA-1
                    STA     $DD0D                       ;"SWITCH OFF" INTERRUPTS SIGNALS FROM CIA-2
                    
                    AND     $D011                       ; SET THE RASTER LINE NUMBER WHERE INTERRUPT SHOULD OCCUR
                    STA     $D011                       ; [$D011 bit 7] (0 * 255) + [$D012] 048 = line 48
                    LDA     #048                        
                    STA     $D012     
                    
                    LDA     $DC0D                       ; by reading this two registers we negate any pending CIA irqs.
                    LDA     $DD0D                       ; if we don't do this, a pending CIA irq might occur after we finish setting up our irq.
                                                        ; we don't want that to happen.
             
                    LDA     #$35                        ; turn off BASIC ROM and KERNAL: http://sta.c64.org/cbm64mem.html
                    STA     $01     

                    LDA     #<IRQ_PlayMusic             ; Set the intterupt address
                    STA     $FFFE                       
                    LDA     #>IRQ_PlayMusic                      
                    STA     $FFFF                      
                    
                    LDA     #%00000001                  
                    STA     $D01A                       ;ENABLE RASTER INTERRUPT SIGNALS FROM VIC

                    CLI                                 ; enable maskable interrupts again
                    
WAIT                JMP     WAIT                        ; INITIALIZATION DONE - just loop and let IRQs do the rest...
                    

; D415   54293               Filter Cutoff Frequency: Low-Nybble (Bits 2-0)
; D416   54294               Filter Cutoff Frequency: High-Byte
; D417   54295               Filter Resonance Control / Voice Input Control
;                     7-4    Select Filter Resonance: 0-15
;                     3      Filter External Input: 1 = Yes, 0 = No
;                     2      Filter Voice 3 Output: 1 = Yes, 0 = No
;                            Filter Voice 2 Output: 1 = Yes, 0 = No
;                     0      Filter Voice 1 Output: 1 = Yes, 0 = No
;
; D418   54296               Select Filter Mode and Volume
;                     7      Cut-Off Voice 3 Output: 1 = Off, O = On
;                     6      Select Filter High-Pass Mode: 1 = On
;                     5      Select Filter Band-Pass Mode: 1 = On
;                     4      Select Filter Low-Pass Mode: 1 = On
;                     3-0    Select Output Volume: 0-15

                    LDA     #%00000000                  
                    STA     $D415                       

                    LDA     #%00111100                  
                    STA     $D416                       

                    LDA     #%01000011                  
                    STA     $D417                       

                    LDA     #%00100001                  
                    STA     $D418                       

IRQ_ChangeBorder    INC     $D020                       ; Changing the border colour gives a visual of how much raster time is being used
                    LDA     #<IRQ_PlayMusic                      
                    STA     $FFFE                       
                    LDA     #>IRQ_PlayMusic                      
                    STA     $FFFF             
          
                    LDA     ColorRAM+040      
                    LDX     #040                        
Loop_Scroll_Text    TAY
                    INY
                    TYA
                    AND     #%00001111                  
                    BNE     Scroll_Text                      
                    INY
                    TYA
Scroll_Text         STA     ColorRAM+040,X
                    DEX
                    BPL     Loop_Scroll_Text                       


IRQ_PlayMusic       INC     $D020
                    
                    DEC     Note_Cnt                    ; Unrolled note countdown
                    DEC     Note_Cnt+1                 

                    LDX     #000                        ; Loop V2, V1
Check_Note          LDA     Note_Cnt,X                

                    STA     $0400    
                    
                    CMP     #000
                    BEQ     ChangeNote                  ; if 0, change note
                    ;CMP     #020                        
                    ;BMI     PulseChange                 ; if ?? 20, change pulse....
                       
                    LDA     Control_Ghost,X             
                    AND     #%11111110                  ; Fade note out
                    STA     V1_Control                  ; TO-DO - Set notes for right voice (use zero page?)
                    STA     Control_Ghost,X             
                    DEX                     
                    BPL     Check_Note                  ; loop
                    JMP     PulseChange                        

ChangeNote          INC     Note_Num,X
                    LDA     Note_Num,X   
                    TAY               
                    LDA     Song1_S1_Notes,Y            ; TO-DO - Set notes for right voice
                    
                    STX     $0401    
                    STA     $0402    
                    STY     $0403      
                    
                    CPY     #$ff                        ; #$ff is "loop track" marker in note data
                    BNE     ChangeNote2                    
                    
                    INC     $D021
                    LDY     #$00                        ; if told, loop back to start of voice info
                    
ChangeNote2         LDA     #<IRQ_ChangeBorder
                    STA     $FFFE                       
                    LDA     #>IRQ_ChangeBorder                       
                    STA     $FFFF                       
                    
                    ; A = ??, X = Voice index, Y = Note_Num index
                                   
                    LDA     Song1_S1_Length,Y           
                    STA     Note_Cnt,X                                      
                    LDA     Song1_S1_Notes,Y 
                    STA     Note_Num,X                  

                    TAY                   
                    LDA     Note_Lo,Y                 
                    STA     V1_Freq_Lo                  
                    LDA     Note_Hi,Y                   
                    STA     V1_Freq_Hi                  
                    LDA     #023                        
                    STA     V1_Pulse_Lo                 
                    STA     Pulse_Lo_Ghost,X               
                    LDA     #$08                        
                    STA     V1_Pulse_Hi                 
                    STA     Pulse_Hi_Ghost,X              
                    LDA     Control_Ghost,X              
                    ORA     #%00000001                  
                    STA     V1_Control                  
                    STA     Control_Ghost,X              
                    
                    ; end of loop
                    DEX                     
                    BPL     Check_Note                  ; loop
             
                    JMP     RTIMusic                    

PulseChange         AND     #%00000010
                    BNE     PulseUp                     
PulseDown           LDA     Pulse_Lo_Ghost,X
                    SEC
                    SBC     #$40                        
                    STA     Pulse_Lo_Ghost,X             
                    STA     V1_Pulse_Lo   

                    DEX                     
                    BMI     RTIMusic                    ; loop  
                    JMP     Check_Note                    

PulseUp             LDA     Pulse_Hi_Ghost,X
                    CLC
                    ADC     #$20                        
                    STA     Pulse_Hi_Ghost,X            
                    STA     V1_Pulse_Hi                 
                    
                    DEX                     
                    BMI     RTIMusic                    ; loop        
                    JMP     Check_Note                          

RTIMusic            ASL     $D019                       ;"Acknowledge" the interrupt by clearing the VIC's interrupt flag.
                    DEC     $D020
                    RTI                  